<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impossible Door Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 30px;
        }
        #game-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #2c2c2c;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #doors {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            perspective: 1000px;
        }
        .door {
            width: 100px;
            height: 180px;
            background: linear-gradient(135deg, #8b4513, #5c4033);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border: 3px solid #3c2f2f;
            border-radius: 10px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3);
            position: relative;
            transform: rotateY(10deg);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .door:hover {
            transform: rotateY(0deg) scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        .door::after {
            content: '';
            position: absolute;
            right: 10px;
            width: 10px;
            height: 40px;
            background-color: #d4a017;
            border-radius: 5px;
        }
        #message {
            font-size: 22px;
            margin: 20px 0;
            min-height: 44px;
        }
        #riddle, #challenge {
            font-size: 20px;
            font-style: italic;
            margin: 20px 0;
            color: #e0e0e0;
            background-color: #3a3a3a;
            padding: 15px;
            border-radius: 10px;
        }
        #challenge-input {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            width: 200px;
        }
        #submit-challenge {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        #submit-challenge:hover {
            background-color: #45a049;
        }
        #stage {
            font-size: 24px;
            margin: 10px 0;
        }
        #restart, #home {
            padding: 15px 30px;
            font-size: 18px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        #restart:hover, #home:hover {
            background-color: #45a049;
        }
        #restart { display: none; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Impossible Door Game</h1>
        <p>Navigate through 10 stages by solving cryptic riddles to pick the correct door. Survive brutal challenges after stages 3, 6, and 9.</p>
        <p id="stage">Stage 1</p>
        <div id="riddle"></div>
        <div id="challenge" style="display: none;"></div>
        <input id="challenge-input" type="text" style="display: none;" placeholder="Enter answer">
        <button id="submit-challenge" style="display: none;">Submit</button>
        <div id="doors"></div>
        <p id="message"></p>
        <button id="home" onclick="window.location.href='index.html'">Back to Home</button>
        <button id="restart">Play Again</button>
    </div>

    <script>
        let currentStage = 1;
        let numDoors;
        let correctDoor;
        let challengeActive = false;
        let challengeAnswer;
        let category = new URLSearchParams(window.location.search).get('category') || 'math';
        let difficulty = new URLSearchParams(window.location.search).get('difficulty') || 'medium';

        // Riddles: 10 per door number (1–10) for each category (Math, History, Music, Animals)
        const riddles = {
            math: [
                // Door 1
                { text: "I am the unity, the start of all counts. In binary, I’m one bit’s amount.", answer: 1 },
                { text: "The first of naturals, no less can be. I’m the identity of multiplicity.", answer: 1 },
                { text: "In a line of ten, I lead the race. No number precedes my place.", answer: 1 },
                { text: "Factorial of me is me alone. I’m the first door, set in stone.", answer: 1 },
                { text: "In modulo any, I’m always myself. I’m the first on the numerical shelf.", answer: 1 },
                { text: "I’m the root of one, no more, no less. Choose me to begin your quest.", answer: 1 },
                { text: "The sum of no numbers, yet I exist. I’m the first door you can’t resist.", answer: 1 },
                { text: "I’m the order of the trivial group. First door, I’m in the loop.", answer: 1 },
                { text: "No divisors but myself and me. I’m the smallest such, what door could I be?", answer: 1 },
                { text: "I’m the smallest positive integer. What door am I, the game’s beginner?", answer: 1 },
                // Door 2 (sample, full list follows same pattern)
                { text: "I’m the only even prime, standing alone. What door am I in this cryptic zone?", answer: 2 },
                { text: "Divide me by three, the remainder is me. I’m the smallest door of prime degree.", answer: 2 },
                { text: "My square is the next perfect square after one. What door am I when the math is done?", answer: 2 },
                { text: "I’m the number of elements in a binary choice. Pick my door, let your voice.", answer: 2 },
                { text: "The first Fibonacci pair sums to me. What door unlocks this mystery?", answer: 2 },
                { text: "I’m one less than the smallest odd prime. What door am I in this climb?", answer: 2 },
                { text: "In a triangle, I’m the second side count. What door am I in this amount?", answer: 2 },
                { text: "My divisors are one and me, I’m not one. What door am I when the riddle’s done?", answer: 2 },
                { text: "I’m the sum of one and one. What door am I when the count is done?", answer: 2 },
                { text: "I’m the smallest number with exactly two divisors. What door am I, the prime endorser?", answer: 2 },
                // Add 10 riddles for doors 3–10 similarly...
            ],
            history: [
                // Door 1
                { text: "The century of Rome’s founding, minus seven hundred fifty-two. What door am I, true?", answer: 1 }, // 753 BC ≈ 1
                { text: "The number of Punic Wars, minus two. What door am I to get through?", answer: 1 }, // 3 - 2 = 1
                { text: "The Crusades began in ten ninety-five. Divide by one thousand ninety-five. What door am I, alive?", answer: 1 },
                { text: "The Magna Carta’s century, minus twelve hundred. What door am I, unburdened?", answer: 1 }, // 1215 ≈ 13th century - 12 = 1
                { text: "The number of English kings named Edward, divided by eight. What door’s my fate?", answer: 1 }, // 8 ÷ 8 = 1
                { text: "The century of the Black Death’s peak, minus thirteen. What door do you seek?", answer: 1 }, // 14th century - 13 = 1
                { text: "The number of years in Caesar’s reign, minus four. What door, no more?", answer: 1 }, // ~5 - 4 = 1
                { text: "The first millennium’s end, divided by one thousand. What door to send?", answer: 1 },
                { text: "The number of Cleopatra’s children, minus three. What door am I, set free?", answer: 1 }, // 4 - 3 = 1
                { text: "The century of the American Revolution, minus seventeen. What door is seen?", answer: 1 }, // 18th century - 17 = 1
                // Door 2
                { text: "The World Wars fought in the twentieth century. What door am I, entry?", answer: 2 },
                { text: "The number of consuls in Rome’s Republic at once. What door’s response?", answer: 2 },
                { text: "The Treaty of Versailles ended World War I in nineteen nineteen. Divide by nine hundred fifty-nine point five. What door is seen?", answer: 2 },
                { text: "The number of terms Lincoln served. What door am I, preserved?", answer: 2 },
                { text: "The Punic Wars fought by Rome. Divide by one point five. What door’s my home?", answer: 2 }, // 3 ÷ 1.5 = 2
                { text: "Napoleon’s exile islands, count them true. What door am I to get through?", answer: 2 },
                { text: "The century of the French Revolution, minus seventeen. What door is seen?", answer: 2 }, // 18th - 17 = 2
                { text: "The number of atomic bombs used in war. What door am I, no more?", answer: 2 },
                { text: "The number of sides in the Hundred Years’ War. What door’s my star?", answer: 2 },
                { text: "The number of queens named Elizabeth ruling England. What door’s my standing?", answer: 2 },
                // Add 10 riddles for doors 3–10...
            ],
            music: [
                // Door 1
                { text: "I’m the number of notes in a unison interval. What door am I, pivotal?", answer: 1 },
                { text: "The number of hands to play a single piano note. What door’s my vote?", answer: 1 },
                { text: "The number of beats in a semibreve in common time. Divide by four. What door’s sublime?", answer: 1 },
                { text: "The number of strings on a monochord. What door’s my accord?", answer: 1 },
                { text: "The number of movements in a solo cadenza. What door’s my stanza?", answer: 1 },
                { text: "The number of voices in a solo aria. What door am I, near and far?", answer: 1 },
                { text: "The number of keys in a single pitch class. What door’s my class?", answer: 1 },
                { text: "The number of beats in a quarter note. What door’s my note?", answer: 1 },
                { text: "The number of conductors in a standard orchestra. What door’s my aura?", answer: 1 },
                { text: "The number of tones in a single pitch. What door’s my niche?", answer: 1 },
                // Door 2
                { text: "The number of strings on a standard mandolin, divided by two. What door am I, true?", answer: 2 }, // 4 ÷ 2 = 2
                { text: "The number of beats in a half note in common time. What door’s my rhyme?", answer: 2 },
                { text: "The number of voices in a duet. What door’s my set?", answer: 2 },
                { text: "The number of hands on a piano duet. What door’s my bet?", answer: 2 },
                { text: "The number of strings on a standard violin, minus two. What door’s my cue?", answer: 2 }, // 4 - 2 = 2
                { text: "The number of movements in Beethoven’s Moonlight Sonata, minus one. What door’s done?", answer: 2 }, // 3 - 1 = 2
                { text: "The number of sharps in D major. What door’s my star?", answer: 2 },
                { text: "The number of beats in a minim. What door’s my hymn?", answer: 2 },
                { text: "The number of players in a guitar duo. What door’s my show?", answer: 2 },
                { text: "The number of clefs in standard sheet music. What door’s my pick?", answer: 2 },
                // Add 10 riddles for doors 3–10...
            ],
            animals: [
                // Door 1
                { text: "The number of humps on a Trampel camel. What door am I, mammal?", answer: 1 },
                { text: "The number of horns on a rhinoceros, in most species. What door’s my thesis?", answer: 1 },
                { text: "The number of eyes on a cyclops fish. What door’s my wish?", answer: 1 },
                { text: "The number of legs on a jellyfish. Divide by zero or count none. What door’s done?", answer: 1 },
                { text: "The number of tails on a standard peacock. What door’s my flock?", answer: 1 },
                { text: "The number of hearts in a hagfish, minus two. What door’s my cue?", answer: 1 }, // 3 - 2 = 1
                { text: "The number of wings on an ostrich, divided by two. What door’s my clue?", answer: 1 }, // 2 ÷ 2 = 1
                { text: "The number of heads on a typical hydra in myth, minus six. What door’s my fix?", answer: 1 }, // 7 - 6 = 1
                { text: "The number of spots on a Dalmatian, divided by one hundred one. What door’s won?", answer: 1 },
                { text: "The number of lives a cat is said to have, divided by nine. What door’s mine?", answer: 1 },
                // Door 2
                { text: "The number of wings on a typical bird. What door’s my word?", answer: 2 },
                { text: "The number of legs on a bipedal creature. What door’s my feature?", answer: 2 },
                { text: "The number of eyes on most spiders, divided by four. What door’s my score?", answer: 2 }, // 8 ÷ 4 = 2
                { text: "The number of humps on a Bactrian camel. What door’s my mammal?", answer: 2 },
                { text: "The number of tusks on a typical walrus. What door’s my chorus?", answer: 2 },
                { text: "The number of antennae on a butterfly. What door’s my try?", answer: 2 },
                { text: "The number of legs on a crab, divided by five. What door’s alive?", answer: 2 }, // 10 ÷ 5 = 2
                { text: "The number of tails on a kitsune, minus seven. What door’s my heaven?", answer: 2 }, // 9 - 7 = 2
                { text: "The number of heads on a two-headed snake. What door’s my stake?", answer: 2 },
                { text: "The number of parents in a standard brood. What door’s my good?", answer: 2 },
                // Add 10 riddles for doors 3–10...
            ]
        };

        // Challenges by difficulty
        const challenges = {
            easy: [
                { text: "What is 2 + 3?", answer: "5" },
                { text: "How many days are in a week?", answer: "7" },
                { text: "What is the number of months in a year, divided by six?", answer: "2" },
                { text: "How many legs does a human have?", answer: "2" },
                { text: "What is 10 minus 7?", answer: "3" }
            ],
            medium: [
                { text: "Solve: If x² - 5x + 6 = 0, what is the sum of the roots?", answer: "5" },
                { text: "In a group of 4 people, each shakes hands with everyone else once. How many handshakes?", answer: "6" },
                { text: "What is the next number in the sequence: 1, 3, 6, 10, ?", answer: "15" },
                { text: "If today is Monday, what is the day number (1=Sunday, 7=Saturday)?", answer: "2" },
                { text: "How many sides does a pentagon have?", answer: "5" }
            ],
            hard: [
                { text: "Solve: If x² - 7x + 12 = 0, what is the product of the roots?", answer: "12" },
                { text: "What is the next number in the sequence: 1, 4, 10, 22, 46, ?", answer: "94" },
                { text: "In a group of 5 people, each gives a gift to every other person. How many gifts?", answer: "20" },
                { text: "A knight moves from (1,1) to (4,3) on a chessboard. Minimum moves?", answer: "2" },
                { text: "If the day after tomorrow is Wednesday, what is today’s day number (1=Sunday, 7=Saturday)?", answer: "1" }
            ]
        };

        function startStage() {
            document.getElementById('doors').innerHTML = '';
            document.getElementById('message').innerText = '';
            document.getElementById('restart').style.display = 'none';
            document.getElementById('challenge').style.display = 'none';
            document.getElementById('challenge-input').style.display = 'none';
            document.getElementById('submit-challenge').style.display = 'none';
            challengeActive = false;

            if ([4, 7, 10].includes(currentStage)) {
                startChallenge();
                return;
            }

            numDoors = Math.floor(Math.random() * 7) + 4; // 4 to 10 doors
            document.getElementById('stage').innerText = `Stage ${currentStage} (${category.charAt(0).toUpperCase() + category.slice(1)} - ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)})`;

            const validRiddles = riddles[category].filter(riddle => riddle.answer <= numDoors);
            const riddle = validRiddles[Math.floor(Math.random() * validRiddles.length)];
            correctDoor = riddle.answer;
            document.getElementById('riddle').innerText = `Riddle: ${riddle.text}`;

            for (let i = 1; i <= numDoors; i++) {
                const door = document.createElement('div');
                door.className = 'door';
                door.innerText = i;
                door.addEventListener('click', () => chooseDoor(i));
                document.getElementById('doors').appendChild(door);
            }
        }

        function startChallenge() {
            challengeActive = true;
            document.getElementById('doors').innerHTML = '';
            document.getElementById('riddle').innerText = '';
            const challenge = challenges[difficulty][Math.floor(Math.random() * challenges[difficulty].length)];
            challengeAnswer = challenge.answer;
            document.getElementById('challenge').innerText = `Challenge: ${challenge.text}`;
            document.getElementById('challenge').style.display = 'block';
            document.getElementById('challenge-input').style.display = 'inline-block';
            document.getElementById('submit-challenge').style.display = 'inline-block';
            document.getElementById('message').innerText = 'Solve the challenge to proceed!';
        }

        function chooseDoor(doorNumber) {
            if (challengeActive) return;
            const doors = document.getElementsByClassName('door');
            for (let door of doors) {
                door.style.pointerEvents = 'none';
            }

            if (doorNumber === correctDoor) {
                document.getElementById('message').innerText = `Correct! Door ${doorNumber} was the right one.`;
                currentStage++;
                if (currentStage > 10) {
                    document.getElementById('message').innerText = 'Congratulations! You beat the impossible game!';
                    document.getElementById('riddle').innerText = '';
                    document.getElementById('restart').style.display = 'block';
                } else {
                    setTimeout(startStage, 1500);
                }
            } else {
                document.getElementById('message').innerText = `Wrong! Door ${correctDoor} was the correct one. Game Over!`;
                document.getElementById('restart').style.display = 'block';
            }
        }

        function checkChallenge() {
            const userAnswer = document.getElementById('challenge-input').value.trim();
            if (userAnswer === challengeAnswer) {
                document.getElementById('message').innerText = 'Challenge solved! Proceeding to next stage.';
                document.getElementById('challenge').style.display = 'none';
                document.getElementById('challenge-input').style.display = 'none';
                document.getElementById('submit-challenge').style.display = 'none';
                challengeActive = false;
                currentStage++; // Ensure stage increments
                setTimeout(startStage, 1500);
            } else {
                document.getElementById('message').innerText = `Wrong answer! Game Over!`;
                document.getElementById('restart').style.display = 'block';
            }
            document.getElementById('challenge-input').value = '';
        }

        document.getElementById('submit-challenge').addEventListener('click', checkChallenge);
        document.getElementById('challenge-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkChallenge();
        });

        document.getElementById('restart').addEventListener('click', () => {
            currentStage = 1;
            startStage();
        });

        startStage();
    </script>
</body>
</html>